(function(a,b){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(g,h,e){a.Backbone=b(a,e,g,h)})}else{if(typeof exports!=="undefined"){var c=require("underscore"),d;try{d=require("jquery")}catch(f){}b(a,exports,c,d)}else{a.Backbone=b(a,{},a._,(a.jQuery||a.Zepto||a.ender||a.$))}}}(this,function(v,C,O,B){var F=v.Backbone;var h=[];var o=h.slice;C.VERSION="1.1.2";C.$=B;C.noConflict=function(){v.Backbone=F;return this};C.emulateHTTP=false;C.emulateJSON=false;var L=C.Events={};var x=/\s+/;var y=function(T,V,P,W,Q,X){var S=0,U,R;if(P&&typeof P==="object"){for(U=O.keys(P);S<U.length;S++){V=T(V,U[S],P[U[S]],Q,X)}}else{if(P&&x.test(P)){for(U=P.split(x);S<U.length;S++){V=T(V,U[S],W,Q,X)}}else{V=T(V,P,W,Q,X)}}return V};L.on=function(P,R,Q){this._events=y(A,this._events||{},P,R,Q,this);return this};L.listenTo=function(T,P,V){if(!T){return this}var U=T._listenId||(T._listenId=O.uniqueId("l"));var R=this._listeningTo||(this._listeningTo={});var Q=R[U];if(!Q){Q=R[U]={obj:T,events:{}};U=this._listenId||(this._listenId=O.uniqueId("l"));var S=T._listeners||(T._listeners={});S[U]=this}T.on(P,V,this);Q.events=y(A,Q.events,P,V);return this};var A=function(T,R,U,S,P){if(U){var Q=T[R]||(T[R]=[]);Q.push({callback:U,context:S,ctx:S||P})}return T};L.off=function(P,V,R){if(!this._events){return this}this._events=y(d,this._events,P,V,R);var T=this._listeners;if(T){var S=R!=null?[R._listenId]:O.keys(T);for(var Q=0;Q<S.length;Q++){var U=T[S[Q]];if(!U){break}M(U,this,P,V)}if(O.isEmpty(T)){this._listeners=void 0}}return this};L.stopListening=function(Q,P,R){if(this._listeningTo){M(this,Q,P,R,true)}return this};var d=function(Z,P,X,Q){if(!Z||!P&&!Q&&!X){return}var W=P?[P]:O.keys(Z);for(var V=0;V<W.length;V++){P=W[V];var R=Z[P];if(!R){break}var T=[];if(X||Q){for(var U=0,S=R.length;U<S;U++){var Y=R[U];if(X&&X!==Y.callback&&X!==Y.callback._callback||Q&&Q!==Y.context){T.push(Y)}}}if(T.length){Z[P]=T}else{delete Z[P]}}if(!O.isEmpty(Z)){return Z}};var M=function(T,U,Q,Y,S){var X=T._listeningTo;var P=U?[U._listenId]:O.keys(X);for(var V=0;V<P.length;V++){var R=P[V];var W=X[R];if(!W){break}U=W.obj;if(S){U._events=y(d,U._events,Q,Y,T)}var Z=y(d,W.events,Q,Y);if(!Z){delete X[R];delete W.obj._listeners[T._listenId]}}if(O.isEmpty(X)){T._listeningTo=void 0}};L.once=function(P,S,R){var Q=E(P,S,O.bind(this.off,this));return this.on(Q,void 0,R)};L.listenToOnce=function(R,P,S){var Q=E(P,S,O.bind(this.stopListening,this,R));return this.listenTo(R,Q)};var E=function(P,R,Q){return y(function(V,S,W,U){if(W){var T=V[S]=O.once(function(){U(S,T);W.apply(this,arguments)});T._callback=W}return V},{},P,R,Q)};L.trigger=function(Q){if(!this._events){return this}var S=Math.max(0,arguments.length-1);var P=Array(S);for(var R=0;R<S;R++){P[R]=arguments[R+1]}y(n,this,Q,void 0,P);return this};var n=function(U,S,P,R){if(U._events){var T=U._events[S];var Q=U._events.all;if(T){b(T,R)}if(Q){b(Q,[S].concat(R))}}return U};var b=function(U,S){var V,T=-1,R=U.length,Q=S[0],P=S[1],W=S[2];switch(S.length){case 0:while(++T<R){(V=U[T]).callback.call(V.ctx)}return;case 1:while(++T<R){(V=U[T]).callback.call(V.ctx,Q)}return;case 2:while(++T<R){(V=U[T]).callback.call(V.ctx,Q,P)}return;case 3:while(++T<R){(V=U[T]).callback.call(V.ctx,Q,P,W)}return;default:while(++T<R){(V=U[T]).callback.apply(V.ctx,S)}return}};var G=function(Q,R,P){switch(Q){case 1:return function(){return O[R](this[P])};case 2:return function(S){return O[R](this[P],S)};case 3:return function(T,S){return O[R](this[P],T,S)};case 4:return function(T,U,S){return O[R](this[P],T,U,S)};default:return function(){var S=o.call(arguments);S.unshift(this[P]);return O[R].apply(O,S)}}};var s=function(Q,P,R){O.each(P,function(S,T){if(O[T]){Q.prototype[T]=G(S,T,R)}})};L.bind=L.on;L.unbind=L.off;O.extend(C,L);var H=C.Model=function(P,R){var Q=P||{};R||(R={});this.cid=O.uniqueId(this.cidPrefix);this.attributes={};if(R.collection){this.collection=R.collection}if(R.parse){Q=this.parse(Q,R)||{}}Q=O.defaults({},Q,O.result(this,"defaults"));this.set(Q,R);this.changed={};this.initialize.apply(this,arguments)};O.extend(H.prototype,L,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(P){return O.clone(this.attributes)},sync:function(){return C.sync.apply(this,arguments)},get:function(P){return this.attributes[P]},escape:function(P){return O.escape(this.get(P))},has:function(P){return this.get(P)!=null},matches:function(P){return !!O.iteratee(P,this)(this.attributes)},set:function(W,P,aa){var U,X,Y,V,T,Z,Q,S;if(W==null){return this}if(typeof W==="object"){X=W;aa=P}else{(X={})[W]=P}aa||(aa={});if(!this._validate(X,aa)){return false}Y=aa.unset;T=aa.silent;V=[];Z=this._changing;this._changing=true;if(!Z){this._previousAttributes=O.clone(this.attributes);this.changed={}}S=this.attributes,Q=this._previousAttributes;if(this.idAttribute in X){this.id=X[this.idAttribute]}for(U in X){P=X[U];if(!O.isEqual(S[U],P)){V.push(U)}if(!O.isEqual(Q[U],P)){this.changed[U]=P}else{delete this.changed[U]
}Y?delete S[U]:S[U]=P}if(!T){if(V.length){this._pending=aa}for(var R=0;R<V.length;R++){this.trigger("change:"+V[R],this,S[V[R]],aa)}}if(Z){return this}if(!T){while(this._pending){aa=this._pending;this._pending=false;this.trigger("change",this,aa)}}this._pending=false;this._changing=false;return this},unset:function(P,Q){return this.set(P,void 0,O.extend({},Q,{unset:true}))},clear:function(Q){var P={};for(var R in this.attributes){P[R]=void 0}return this.set(P,O.extend({},Q,{unset:true}))},hasChanged:function(P){if(P==null){return !O.isEmpty(this.changed)}return O.has(this.changed,P)},changedAttributes:function(R){if(!R){return this.hasChanged()?O.clone(this.changed):false}var T,S=false;var Q=this._changing?this._previousAttributes:this.attributes;for(var P in R){if(O.isEqual(Q[P],(T=R[P]))){continue}(S||(S={}))[P]=T}return S},previous:function(P){if(P==null||!this._previousAttributes){return null}return this._previousAttributes[P]},previousAttributes:function(){return O.clone(this._previousAttributes)},fetch:function(Q){Q=Q?O.clone(Q):{};if(Q.parse===void 0){Q.parse=true}var P=this;var R=Q.success;Q.success=function(S){if(!P.set(P.parse(S,Q),Q)){return false}if(R){R.call(Q.context,P,S,Q)}P.trigger("sync",P,S,Q)};K(this,Q);return this.sync("read",this,Q)},save:function(U,Q,Y){var V,P,X,R=this.attributes,T;if(U==null||typeof U==="object"){V=U;Y=Q}else{(V={})[U]=Q}Y=O.extend({validate:true},Y);T=Y.wait;if(V&&!T){if(!this.set(V,Y)){return false}}else{if(!this._validate(V,Y)){return false}}if(V&&T){this.attributes=O.extend({},R,V)}if(Y.parse===void 0){Y.parse=true}var S=this;var W=Y.success;Y.success=function(aa){S.attributes=R;var Z=Y.parse?S.parse(aa,Y):aa;if(T){Z=O.extend(V||{},Z)}if(O.isObject(Z)&&!S.set(Z,Y)){return false}if(W){W.call(Y.context,S,aa,Y)}S.trigger("sync",S,aa,Y)};K(this,Y);P=this.isNew()?"create":(Y.patch?"patch":"update");if(P==="patch"&&!Y.attrs){Y.attrs=V}X=this.sync(P,this,Y);if(V&&T){this.attributes=R}return X},destroy:function(Q){Q=Q?O.clone(Q):{};var P=this;var U=Q.success;var S=Q.wait;var R=function(){P.stopListening();P.trigger("destroy",P,P.collection,Q)};Q.success=function(V){if(S||P.isNew()){R()}if(U){U.call(Q.context,P,V,Q)}if(!P.isNew()){P.trigger("sync",P,V,Q)}};if(this.isNew()){Q.success();return false}K(this,Q);var T=this.sync("delete",this,Q);if(!S){R()}return T},url:function(){var P=O.result(this,"urlRoot")||O.result(this.collection,"url")||t();if(this.isNew()){return P}var Q=this.id||this.attributes[this.idAttribute];return P.replace(/([^\/])$/,"$1/")+encodeURIComponent(Q)},parse:function(Q,P){return Q},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(P){return this._validate({},O.extend(P||{},{validate:true}))},_validate:function(R,Q){if(!Q.validate||!this.validate){return true}R=O.extend({},this.attributes,R);var P=this.validationError=this.validate(R,Q)||null;if(!P){return true}this.trigger("invalid",this,P,O.extend(Q,{validationError:P}));return false}});var a={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};s(H,a,"attributes");var c=C.Collection=function(Q,P){P||(P={});if(P.model){this.model=P.model}if(P.comparator!==void 0){this.comparator=P.comparator}this._reset();this.initialize.apply(this,arguments);if(Q){this.reset(Q,O.extend({silent:true},P))}};var p={add:true,remove:true,merge:true};var N={add:true,remove:false};O.extend(c.prototype,L,{model:H,initialize:function(){},toJSON:function(P){return this.map(function(Q){return Q.toJSON(P)})},sync:function(){return C.sync.apply(this,arguments)},add:function(Q,P){return this.set(Q,O.extend({merge:false},P,N))},remove:function(V,R){var T=!O.isArray(V);V=T?[V]:O.clone(V);R||(R={});for(var S=0;S<V.length;S++){var Q=V[S]=this.get(V[S]);if(!Q){continue}var U=this.modelId(Q.attributes);if(U!=null){delete this._byId[U]}delete this._byId[Q.cid];var P=this.indexOf(Q);this.models.splice(P,1);this.length--;if(!R.silent){R.index=P;Q.trigger("remove",Q,this,R)}this._removeReference(Q,R)}return T?V[0]:V},set:function(ai,Q){Q=O.defaults({},Q,p);if(Q.parse){ai=this.parse(ai,Q)}var U=!O.isArray(ai);ai=U?(ai?[ai]:[]):ai.slice();var Z,R,ab,Y,ah;var W=Q.at;if(W!=null){W=+W}if(W<0){W+=this.length+1}var P=this.comparator&&(W==null)&&Q.sort!==false;var ag=O.isString(this.comparator)?this.comparator:null;var aj=[],ac=[],aa={};var X=Q.add,S=Q.merge,ak=Q.remove;var ae=!P&&X&&ak?[]:false;var ad=false;for(var af=0;af<ai.length;af++){ab=ai[af];if(Y=this.get(ab)){if(ak){aa[Y.cid]=true}if(S&&ab!==Y){ab=this._isModel(ab)?ab.attributes:ab;if(Q.parse){ab=Y.parse(ab,Q)}Y.set(ab,Q);if(P&&!ah&&Y.hasChanged(ag)){ah=true}}ai[af]=Y}else{if(X){R=ai[af]=this._prepareModel(ab,Q);if(!R){continue}aj.push(R);this._addReference(R,Q)}}R=Y||R;if(!R){continue}Z=this.modelId(R.attributes);if(ae&&(R.isNew()||!aa[Z])){ae.push(R);ad=ad||!this.models[af]||R.cid!==this.models[af].cid}aa[Z]=true}if(ak){for(var af=0;af<this.length;af++){if(!aa[(R=this.models[af]).cid]){ac.push(R)
}}if(ac.length){this.remove(ac,Q)}}if(aj.length||ad){if(P){ah=true}this.length+=aj.length;if(W!=null){for(var af=0;af<aj.length;af++){this.models.splice(W+af,0,aj[af])}}else{if(ae){this.models.length=0}var V=ae||aj;for(var af=0;af<V.length;af++){this.models.push(V[af])}}}if(ah){this.sort({silent:true})}if(!Q.silent){var T=W!=null?O.clone(Q):Q;for(var af=0;af<aj.length;af++){if(W!=null){T.index=W+af}(R=aj[af]).trigger("add",R,this,T)}if(ah||ad){this.trigger("sort",this,Q)}}return U?ai[0]:ai},reset:function(R,P){P=P?O.clone(P):{};for(var Q=0;Q<this.models.length;Q++){this._removeReference(this.models[Q],P)}P.previousModels=this.models;this._reset();R=this.add(R,O.extend({silent:true},P));if(!P.silent){this.trigger("reset",this,P)}return R},push:function(Q,P){return this.add(Q,O.extend({at:this.length},P))},pop:function(Q){var P=this.at(this.length-1);this.remove(P,Q);return P},unshift:function(Q,P){return this.add(Q,O.extend({at:0},P))},shift:function(Q){var P=this.at(0);this.remove(P,Q);return P},slice:function(){return o.apply(this.models,arguments)},get:function(P){if(P==null){return void 0}var Q=this.modelId(this._isModel(P)?P.attributes:P);return this._byId[P]||this._byId[Q]||this._byId[P.cid]},at:function(P){if(P<0){P+=this.length}return this.models[P]},where:function(P,R){var Q=O.matches(P);return this[R?"find":"filter"](function(S){return Q(S.attributes)})},findWhere:function(P){return this.where(P,true)},sort:function(P){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}P||(P={});if(O.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(O.bind(this.comparator,this))}if(!P.silent){this.trigger("sort",this,P)}return this},pluck:function(P){return O.invoke(this.models,"get",P)},fetch:function(P){P=P?O.clone(P):{};if(P.parse===void 0){P.parse=true}var R=P.success;var Q=this;P.success=function(S){var T=P.reset?"reset":"set";Q[T](S,P);if(R){R.call(P.context,Q,S,P)}Q.trigger("sync",Q,S,P)};K(this,P);return this.sync("read",this,P)},create:function(Q,P){P=P?O.clone(P):{};var R=P.wait;if(!(Q=this._prepareModel(Q,P))){return false}if(!R){this.add(Q,P)}var T=this;var S=P.success;P.success=function(V,W,U){if(R){T.add(V,U)}if(S){S.call(U.context,V,W,U)}};Q.save(null,P);return Q},parse:function(Q,P){return Q},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(P){return P[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(R,Q){if(this._isModel(R)){if(!R.collection){R.collection=this}return R}Q=Q?O.clone(Q):{};Q.collection=this;var P=new this.model(R,Q);if(!P.validationError){return P}this.trigger("invalid",this,P.validationError,Q);return false},_isModel:function(P){return P instanceof H},_addReference:function(Q,P){this._byId[Q.cid]=Q;var R=this.modelId(Q.attributes);if(R!=null){this._byId[R]=Q}Q.on("all",this._onModelEvent,this)},_removeReference:function(Q,P){if(this===Q.collection){delete Q.collection}Q.off("all",this._onModelEvent,this)},_onModelEvent:function(R,Q,T,P){if((R==="add"||R==="remove")&&T!==this){return}if(R==="destroy"){this.remove(Q,P)}if(R==="change"){var S=this.modelId(Q.previousAttributes());var U=this.modelId(Q.attributes);if(S!==U){if(S!=null){delete this._byId[S]}if(U!=null){this._byId[U]=Q}}}this.trigger.apply(this,arguments)}});var z={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:2,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};s(c,z,"models");var l=["groupBy","countBy","sortBy","indexBy"];O.each(l,function(P){if(!O[P]){return}c.prototype[P]=function(S,Q){var R=O.isFunction(S)?S:function(T){return T.get(S)};return O[P](this.models,R,Q)}});var J=C.View=function(P){this.cid=O.uniqueId("view");P||(P={});O.extend(this,O.pick(P,f));this._ensureElement();this.initialize.apply(this,arguments)};var w=/^(\S+)\s*(.*)$/;var f=["model","collection","el","id","attributes","className","tagName","events"];O.extend(J.prototype,L,{tagName:"div",$:function(P){return this.$el.find(P)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(P){this.undelegateEvents();this._setElement(P);this.delegateEvents();return this},_setElement:function(P){this.$el=P instanceof C.$?P:C.$(P);this.el=this.$el[0]},delegateEvents:function(R){if(!(R||(R=O.result(this,"events")))){return this}this.undelegateEvents();for(var Q in R){var S=R[Q];if(!O.isFunction(S)){S=this[R[Q]]}if(!S){continue}var P=Q.match(w);this.delegate(P[1],P[2],O.bind(S,this))}return this},delegate:function(Q,P,R){this.$el.on(Q+".delegateEvents"+this.cid,P,R)
},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(Q,P,R){this.$el.off(Q+".delegateEvents"+this.cid,P,R)},_createElement:function(P){return document.createElement(P)},_ensureElement:function(){if(!this.el){var P=O.extend({},O.result(this,"attributes"));if(this.id){P.id=O.result(this,"id")}if(this.className){P["class"]=O.result(this,"className")}this.setElement(this._createElement(O.result(this,"tagName")));this._setAttributes(P)}else{this.setElement(O.result(this,"el"))}},_setAttributes:function(P){this.$el.attr(P)}});C.sync=function(W,R,Q){var T=k[W];O.defaults(Q||(Q={}),{emulateHTTP:C.emulateHTTP,emulateJSON:C.emulateJSON});var V={type:T,dataType:"json"};if(!Q.url){V.url=O.result(R,"url")||t()}if(Q.data==null&&R&&(W==="create"||W==="update"||W==="patch")){V.contentType="application/json";V.data=JSON.stringify(Q.attrs||R.toJSON(Q))}if(Q.emulateJSON){V.contentType="application/x-www-form-urlencoded";V.data=V.data?{model:V.data}:{}}if(Q.emulateHTTP&&(T==="PUT"||T==="DELETE"||T==="PATCH")){V.type="POST";if(Q.emulateJSON){V.data._method=T}var S=Q.beforeSend;Q.beforeSend=function(X){X.setRequestHeader("X-HTTP-Method-Override",T);if(S){return S.apply(this,arguments)}}}if(V.type!=="GET"&&!Q.emulateJSON){V.processData=false}var P=Q.error;Q.error=function(Y,Z,X){Q.textStatus=Z;Q.errorThrown=X;if(P){P.call(Q.context,Y,Z,X)}};var U=Q.xhr=C.ajax(O.extend(V,Q));R.trigger("request",R,U,Q);return U};var k={"create":"POST","update":"PUT","patch":"PATCH","delete":"DELETE","read":"GET"};C.ajax=function(){return C.$.ajax.apply(C.$,arguments)};var q=C.Router=function(P){P||(P={});if(P.routes){this.routes=P.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var r=/\((.*?)\)/g;var u=/(\(\?)?:\w+/g;var e=/\*\w+/g;var i=/[\-{}\[\]+?.,\\\^$|#\s]/g;O.extend(q.prototype,L,{initialize:function(){},route:function(Q,R,S){if(!O.isRegExp(Q)){Q=this._routeToRegExp(Q)}if(O.isFunction(R)){S=R;R=""}if(!S){S=this[R]}var P=this;C.history.route(Q,function(U){var T=P._extractParameters(Q,U);if(P.execute(S,T,R)!==false){P.trigger.apply(P,["route:"+R].concat(T));P.trigger("route",R,T);C.history.trigger("route",P,R,T)}});return this},execute:function(R,Q,P){if(R){R.apply(this,Q)}},navigate:function(Q,P){C.history.navigate(Q,P);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=O.result(this,"routes");var Q,P=O.keys(this.routes);while((Q=P.pop())!=null){this.route(Q,this.routes[Q])}},_routeToRegExp:function(P){P=P.replace(i,"\\$&").replace(r,"(?:$1)?").replace(u,function(R,Q){return Q?R:"([^/?]+)"}).replace(e,"([^?]*?)");return new RegExp("^"+P+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(P,Q){var R=P.exec(Q).slice(1);return O.map(R,function(T,S){if(S===R.length-1){return T||null}return T?decodeURIComponent(T):null})}});var j=C.History=function(){this.handlers=[];O.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var D=/^[#\/]|\s+$/g;var g=/^\/+|\/+$/g;var I=/#.*$/;j.started=false;O.extend(j.prototype,L,{interval:50,atRoot:function(){var P=this.location.pathname.replace(/[^\/]$/,"$&/");return P===this.root&&!this.getSearch()},decodeFragment:function(P){return decodeURI(P.replace(/%25/g,"%2525"))},getSearch:function(){var P=this.location.href.replace(/#.*/,"").match(/\?.+/);return P?P[0]:""},getHash:function(Q){var P=(Q||this).location.href.match(/#(.*)$/);return P?P[1]:""},getPath:function(){var Q=this.decodeFragment(this.location.pathname+this.getSearch());var P=this.root.slice(0,-1);if(!Q.indexOf(P)){Q=Q.slice(P.length)}return Q.charAt(0)==="/"?Q.slice(1):Q},getFragment:function(P){if(P==null){if(this._usePushState||!this._wantsHashChange){P=this.getPath()}else{P=this.getHash()}}return P.replace(D,"")},start:function(R){if(j.started){throw new Error("Backbone.history has already been started")}j.started=true;this.options=O.extend({root:"/"},this.options,R);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window;this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(g,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var Q=this.root.slice(0,-1)||"/";this.location.replace(Q+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){var S=document.createElement("iframe");S.src="javascript:0";S.style.display="none";S.tabIndex=-1;var P=document.body;this.iframe=P.insertBefore(S,P.firstChild).contentWindow;this.iframe.document.open().close();this.iframe.location.hash="#"+this.fragment}var T=window.addEventListener||function(U,V){return attachEvent("on"+U,V)
};if(this._usePushState){T("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){T("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var P=window.removeEventListener||function(Q,R){return detachEvent("on"+Q,R)};if(this._usePushState){P("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){P("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe.frameElement);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}j.started=false},route:function(P,Q){this.handlers.unshift({route:P,callback:Q})},checkUrl:function(Q){var P=this.getFragment();if(P===this.fragment&&this.iframe){P=this.getHash(this.iframe)}if(P===this.fragment){return false}if(this.iframe){this.navigate(P)}this.loadUrl()},loadUrl:function(P){P=this.fragment=this.getFragment(P);return O.any(this.handlers,function(Q){if(Q.route.test(P)){Q.callback(P);return true}})},navigate:function(S,R){if(!j.started){return false}if(!R||R===true){R={trigger:!!R}}S=this.getFragment(S||"");var P=this.root;if(S===""||S.charAt(0)==="?"){P=P.slice(0,-1)||"/"}var Q=P+S;S=this.decodeFragment(S.replace(I,""));if(this.fragment===S){return}this.fragment=S;if(this._usePushState){this.history[R.replace?"replaceState":"pushState"]({},document.title,Q)}else{if(this._wantsHashChange){this._updateHash(this.location,S,R.replace);if(this.iframe&&(S!==this.getHash(this.iframe))){if(!R.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,S,R.replace)}}else{return this.location.assign(Q)}}if(R.trigger){return this.loadUrl(S)}},_updateHash:function(P,R,S){if(S){var Q=P.href.replace(/(javascript:|#).*$/,"");P.replace(Q+"#"+R)}else{P.hash="#"+R}}});C.history=new j;var m=function(P,R){var Q=this;var T;if(P&&O.has(P,"constructor")){T=P.constructor}else{T=function(){return Q.apply(this,arguments)}}O.extend(T,Q,R);var S=function(){this.constructor=T};S.prototype=Q.prototype;T.prototype=new S;if(P){O.extend(T.prototype,P)}T.__super__=Q.prototype;return T};H.extend=c.extend=q.extend=J.extend=j.extend=m;var t=function(){throw new Error('A "url" property or function must be specified')};var K=function(R,Q){var P=Q.error;Q.error=function(S){if(P){P.call(Q.context,R,S,Q)}R.trigger("error",R,S,Q)}};return C}));